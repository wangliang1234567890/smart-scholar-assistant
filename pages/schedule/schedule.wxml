<!-- pages/schedule/schedule.wxml -->
<view class="page-container">
  <!-- 头部区域 -->
  <view class="header-section">
    <view class="header-left">
      <image src="/images/tab/schedule.svg" class="header-icon" />
      <text class="header-title">课程表</text>
    </view>
    <view class="header-right">
      <van-button size="small" type="primary" round bind:tap="navigateToAddCourse">
        <van-icon name="plus" />
        <text>添加</text>
      </van-button>
    </view>
  </view>

  <!-- 当前周信息 -->
  <view class="week-info">
    <text class="week-text">{{weekText}}</text>
  </view>

  <!-- 视图切换 -->
  <view class="view-toggle">
    <view class="toggle-item {{viewMode === 'week' ? 'active' : ''}}" bind:tap="switchViewMode" data-mode="week">
      <text>周视图</text>
    </view>
    <view class="toggle-item {{viewMode === 'day' ? 'active' : ''}}" bind:tap="switchViewMode" data-mode="day">
      <text>日视图</text>
    </view>
  </view>

  <!-- 周视图日历 -->
  <view class="week-calendar">
    <view class="week-header">
      <view wx:for="{{weekDays}}" wx:key="index" class="week-day-header">{{item}}</view>
    </view>
    <view class="week-dates">
      <view wx:for="{{currentWeekDates}}" wx:key="date" 
            class="date-item {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}}"
            bind:tap="onDateSelect" data-date="{{item.fullDate}}">
        <view class="date-number">{{item.date}}</view>
        <view wx:if="{{item.hasCourse}}" class="course-indicators">
          <view wx:for="{{item.courses}}" wx:key="id" class="course-dot {{item.subject}}"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 今日课程 -->
  <view class="today-section">
    <view class="section-header">
      <text class="section-title">今日课程 ({{selectedDayCount}})</text>
      <view class="header-action" bind:tap="navigateToAddCourse">
        <van-icon name="plus" />
        <text>添加</text>
      </view>
    </view>

    <block wx:if="{{todayCourses.length > 0}}">
      <view class="course-list">
        <view wx:for="{{todayCourses}}" wx:key="id" class="course-item" bind:tap="onCourseDetail" data-course="{{item}}">
          <view class="course-left">
            <view class="course-icon {{item.subject}}">
              <text class="icon-text">{{item.subjectShort}}</text>
            </view>
          </view>
          <view class="course-content">
            <view class="course-title">{{item.name}}</view>
            <view class="course-time">
              <van-icon name="clock-o" size="12" />
              <text>{{item.startTime}}-{{item.endTime}} ({{item.duration}}分钟)</text>
            </view>
            <view class="course-location">
              <van-icon name="location-o" size="12" />
              <text>{{item.location}}</text>
            </view>
            <view class="course-teacher">
              <image src="{{item.teacherAvatar || '/images/default-avatar.png'}}" class="teacher-avatar" />
              <text>{{item.teacher}}</text>
            </view>
            <view class="course-note">{{item.description}}</view>
          </view>
          <view class="course-right">
            <view class="course-type">{{item.courseType}}</view>
            <view wx:if="{{item.hasReminder}}" class="reminder-badge">
              <van-icon name="bell" size="12" />
              <text>已提醒</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    <block wx:else>
      <!-- 空状态 -->
      <view class="empty-state">
        <image src="/images/empty-state-home.svg" class="empty-image" />
        <text class="empty-title">今天还没有课程安排</text>
        <text class="empty-desc">点击上方添加按钮，开始安排你的学习计划</text>
        <van-button type="primary" round bind:tap="navigateToAddCourse">
          <van-icon name="plus" />
          <text>添加课程</text>
        </van-button>
      </view>
    </block>
  </view>

  <!-- 全屏日历 -->
  <van-calendar
    show="{{ showCalendar }}"
    bind:close="onCloseCalendar"
    bind:confirm="onConfirmCalendar"
    formatter="{{ calendarFormatter }}"
  />
</view> 