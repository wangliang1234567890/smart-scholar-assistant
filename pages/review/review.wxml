<!-- pages/review/review.wxml -->
<view class="page-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar">
    <view class="navbar-content" style="margin-top: {{statusBarHeight}}px;">
      <view class="navbar-left" bind:tap="onBack">
        <van-icon name="arrow-left" size="24px" color="#1F2937" />
      </view>
      <view class="navbar-center">
        <text class="navbar-title">{{pageTitle}}</text>
        <text class="navbar-subtitle">{{pageSubtitle}}</text>
      </view>
      <view class="navbar-right" bind:tap="onMenu">
        <van-icon name="more-o" size="24px" color="#1F2937" />
      </view>
    </view>
  </view>

  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content" style="margin-top: {{totalNavHeight}}px;">
    <!-- é¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ -->
    <view class="stats-section">
      <view class="stat-item">
        <view class="stat-icon pending">
          <text class="icon-text">ğŸ“–</text>
        </view>
        <view class="stat-content">
          <text class="stat-number">{{reviewStats.pending}}</text>
          <text class="stat-label">å¾…å¤ä¹ </text>
        </view>
      </view>

      <view class="stat-item">
        <view class="stat-icon completed">
          <text class="icon-text">âœ…</text>
        </view>
        <view class="stat-content">
          <text class="stat-number">{{reviewStats.completed}}</text>
          <text class="stat-label">å·²å¤ä¹ </text>
        </view>
      </view>

      <view class="stat-item">
        <view class="stat-icon accuracy">
          <text class="icon-text">ğŸ“ˆ</text>
        </view>
        <view class="stat-content">
          <text class="stat-number">{{reviewStats.accuracy}}%</text>
          <text class="stat-label">æ­£ç¡®ç‡</text>
        </view>
      </view>
    </view>

    <!-- å¤ä¹ æ¨¡å¼ -->
    <view class="modes-section">
      <view class="section-title">
        <text>å¤ä¹ æ¨¡å¼</text>
  </view>

      <view class="modes-list">
        <view 
          wx:for="{{reviewModes}}" 
          wx:key="id"
          class="mode-item"
          bind:tap="onModeClick"
          data-mode="{{item}}"
        >
          <view class="mode-icon" style="background-color: {{item.color}};">
            <text class="mode-icon-text">{{item.iconText}}</text>
          </view>
          <view class="mode-content">
            <text class="mode-name">{{item.name}}</text>
            <text class="mode-desc">{{item.desc}}</text>
          </view>
          <van-icon name="arrow" size="16px" color="#9CA3AF" />
        </view>
      </view>
    </view>
    
    <!-- å­¦ç§‘è¿›åº¦ -->
    <view class="progress-section">
      <view class="section-title">
        <text>å­¦ç§‘è¿›åº¦</text>
        <view class="more-action" bind:tap="onViewAllSubjects">
          <text>æŸ¥çœ‹å…¨éƒ¨</text>
        </view>
      </view>
      
      <view class="progress-list">
      <view 
          wx:for="{{subjectProgress}}" 
          wx:key="id"
          class="progress-item"
          bind:tap="onSubjectClick"
        data-subject="{{item}}"
      >
          <view class="progress-header">
            <text class="subject-name">{{item.name}}</text>
            <van-tag 
              color="{{item.urgencyColor}}"
              size="small"
              plain
            >
              {{item.urgencyText}}
            </van-tag>
          </view>
          
          <view class="progress-info">
            <text class="progress-label">è¿›åº¦</text>
            <text class="progress-number">{{item.progress}}/{{item.total}}</text>
        </view>
        
          <view class="progress-bar">
            <view 
              class="progress-fill {{item.urgency}}" 
              style="width: {{item.percentage}}%"
            ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘å¤ä¹ è®°å½• -->
    <view class="recent-section" wx:if="{{recentReviews.length > 0}}">
    <view class="section-title">
      <text>æœ€è¿‘å¤ä¹ </text>
      <view class="more-action" bind:tap="onViewAllReviews">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
    </view>
    
      <view class="recent-list">
      <view 
        wx:for="{{recentReviews}}" 
        wx:key="id"
          class="recent-item"
          bind:tap="onReviewClick"
        data-review="{{item}}"
      >
          <view class="recent-icon">
            <text class="recent-icon-text">âœ…</text>
        </view>
          <view class="recent-content">
            <text class="recent-title">{{item.title}}</text>
            <text class="recent-meta">{{item.date}} Â· {{item.count}}é¢˜</text>
        </view>
          <view class="recent-result">
            <text class="accuracy-rate {{item.accuracy >= 80 ? 'high' : item.accuracy >= 60 ? 'medium' : 'low'}}">
            {{item.accuracy}}%
          </text>
            <text class="accuracy-label">æ­£ç¡®ç‡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-section" wx:if="{{reviewStats.pending === 0}}">
    <van-empty description="æš‚æ— éœ€è¦å¤ä¹ çš„é”™é¢˜">
      <van-button round type="primary" bind:click="onAddMistakes">
        å»å½•é¢˜
      </van-button>
    </van-empty>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <van-loading wx:if="{{loading}}" type="spinner" text="åŠ è½½ä¸­..." />
  </view>
</view> 