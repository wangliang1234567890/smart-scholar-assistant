<!-- pages/result/result.wxml -->
<view class="result-page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="result-header">
    <view class="header-left" bind:tap="goBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <view class="header-title">è¯†åˆ«ç»“æœ</view>
    <view class="header-right" bind:tap="shareResult">
      <text class="share-icon">â‹¯</text>
    </view>
  </view>

  <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
  <view class="image-preview" wx:if="{{originalImagePath}}">
    <image 
      class="preview-image" 
      src="{{originalImagePath}}" 
      mode="aspectFit"
      show-menu-by-longpress="{{true}}"
    />
    <view class="image-info">
      <text class="source-type">{{sourceType === 'camera' ? 'ğŸ“· æ‹ç…§è¯†åˆ«' : 'ğŸ“ ç›¸å†Œé€‰æ‹©'}}</text>
    </view>
  </view>

  <!-- è¯†åˆ«ä¿¡æ¯å¡ç‰‡ -->
  <view class="info-card">
    <view class="info-row">
      <text class="info-label">ç½®ä¿¡åº¦</text>
      <text class="info-value confidence-{{ocrResult.confidence >= 0.8 ? 'high' : ocrResult.confidence >= 0.6 ? 'medium' : 'low'}}">
        {{Math.round(ocrResult.confidence * 100)}}%
      </text>
    </view>
    
    <view class="info-row">
      <text class="info-label">é¢˜ç›®ç±»å‹</text>
      <text class="info-value">{{ocrResult.questionType === 'unknown' ? 'æœªçŸ¥' : ocrResult.questionType}}</text>
    </view>
    
    <view class="info-row">
      <text class="info-label">å­¦ç§‘</text>
      <text class="info-value">{{ocrResult.subject === 'unknown' ? 'æœªçŸ¥' : ocrResult.subject}}</text>
    </view>
    
    <view class="info-row">
      <text class="info-label">éš¾åº¦</text>
      <view class="difficulty-stars">
        <text wx:for="{{5}}" wx:key="index" class="star {{index < ocrResult.difficulty ? 'filled' : ''}}">â˜…</text>
      </view>
    </view>
  </view>

  <!-- è¯†åˆ«æ–‡æœ¬åŒºåŸŸ -->
  <view class="text-card">
    <view class="text-header">
      <text class="text-title">è¯†åˆ«æ–‡æœ¬</text>
      <view class="text-actions">
        <text class="action-btn" bind:tap="copyText">ğŸ“‹ å¤åˆ¶</text>
        <text class="action-btn" bind:tap="{{isEditing ? 'cancelEdit' : 'startEdit'}}">
          {{isEditing ? 'âœ– å–æ¶ˆ' : 'âœï¸ ç¼–è¾‘'}}
        </text>
      </view>
    </view>
    
    <!-- æ˜¾ç¤ºæ¨¡å¼ -->
    <view wx:if="{{!isEditing}}" class="text-display">
      <text class="recognized-text" user-select="{{true}}">{{ocrResult.text || 'æœªè¯†åˆ«åˆ°æ–‡å­—å†…å®¹'}}</text>
    </view>
    
    <!-- ç¼–è¾‘æ¨¡å¼ -->
    <view wx:else class="text-edit">
      <textarea 
        class="text-input"
        value="{{editedText}}"
        placeholder="è¯·è¾“å…¥æˆ–ä¿®æ”¹è¯†åˆ«çš„æ–‡å­—å†…å®¹"
        maxlength="2000"
        auto-height="{{true}}"
        bind:input="onTextInput"
      />
      <view class="edit-actions">
        <button class="edit-btn cancel-btn" bind:tap="cancelEdit">å–æ¶ˆ</button>
        <button class="edit-btn save-btn" bind:tap="saveEdit">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="action-button secondary" bind:tap="retryRecognition">
      ğŸ”„ é‡æ–°è¯†åˆ«
    </button>
    
    <button class="action-button secondary" bind:tap="retakePhoto">
      ğŸ“· é‡æ–°æ‹ç…§
    </button>
    
    <button 
      class="action-button primary {{isSaving ? 'loading' : ''}}" 
      bind:tap="saveResult"
      disabled="{{isSaving}}"
    >
      {{isSaving ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜ç»“æœ'}}
    </button>
  </view>
</view>