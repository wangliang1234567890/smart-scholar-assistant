<view class="exam-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">AIæ™ºèƒ½ç»ƒä¹ </text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-card card">
    <view class="loading-content">
      <van-loading type="spinner" size="24px" color="#4A90E2">æ­£åœ¨ç”Ÿæˆæ™ºèƒ½è¯•å·...</van-loading>
      <text class="loading-text">AIæ­£åœ¨æ ¹æ®æ‚¨çš„é”™é¢˜ç”Ÿæˆä¸ªæ€§åŒ–ç»ƒä¹ </text>
    </view>
  </view>

  <!-- è¯•å·å†…å®¹ -->
  <view wx:elif="{{examPaper}}" class="exam-content {{printMode ? 'print-mode' : ''}}">
    
    <!-- è¯•å·ä¿¡æ¯å¡ç‰‡ -->
    <view class="exam-info-card card">
      <view class="card-header">
        <view class="card-title">
          <image class="card-icon" src="/images/icons/white/brain.svg"></image>
          {{examPaper.config.title}}
        </view>
        <text class="card-subtitle">{{examPaper.config.subtitle}}</text>
      </view>
      
      <view class="exam-stats">
        <view class="stat-item">
          <text class="stat-value">{{examPaper.config.totalScore}}</text>
          <text class="stat-label">æ€»åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{examPaper.config.timeLimit}}</text>
          <text class="stat-label">åˆ†é’Ÿ</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{examPaper.metadata.questionCount}}</text>
          <text class="stat-label">é¢˜ç›®</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®å¡ç‰‡ -->
    <view wx:if="{{!printMode}}" class="action-card card">
      <view class="action-buttons">
        <view class="action-btn-item" bind:tap="toggleAnswers">
          <view class="action-btn-icon {{showAnswers ? 'active' : ''}}">ğŸ‘</view>
          <text class="action-btn-text">{{showAnswers ? 'éšè—ç­”æ¡ˆ' : 'æ˜¾ç¤ºç­”æ¡ˆ'}}</text>
        </view>
        
        <view class="action-btn-item" bind:tap="enterPrintMode">
          <view class="action-btn-icon">ğŸ“„</view>
          <text class="action-btn-text">æ‰“å°è¯•å·</text>
      </view>

        <view class="action-btn-item primary" bind:tap="startAnswering">
          <view class="action-btn-icon">âœï¸</view>
          <text class="action-btn-text">å¼€å§‹ç­”é¢˜</text>
        </view>
      </view>
    </view>

    <!-- è¯•å·ä¸»ä½“ -->
    <view class="exam-body">
      <view wx:for="{{examPaper.sections}}" wx:key="type" class="section-card card">
        <view class="section-header">
          <view class="section-title">{{item.name}}</view>
          <view class="section-info">
            å…±{{item.questions.length}}é¢˜ï¼Œæ¯é¢˜{{item.scorePerQuestion}}åˆ†
          </view>
        </view>

        <view class="questions-list">
          <view wx:for="{{item.questions}}" wx:for-item="question" wx:for-index="qIndex" wx:key="id" class="question-item">
            
            <!-- é¢˜ç›®æ ‡é¢˜ -->
            <view class="question-header">
              <view class="question-number">{{qIndex + 1}}</view>
              <view class="question-content">
                <text class="question-text">{{question.content}}</text>
              <text class="question-score">ï¼ˆ{{item.scorePerQuestion}}åˆ†ï¼‰</text>
              </view>
            </view>

            <!-- é€‰æ‹©é¢˜é€‰é¡¹ -->
            <view wx:if="{{question.options}}" class="question-options">
              <view wx:for="{{question.options}}" wx:for-item="option" wx:key="index" class="option-item {{showAnswers && option.charAt(0) === question.correctAnswer ? 'correct' : ''}}">
                <text class="option-text">{{option}}</text>
                <view wx:if="{{showAnswers && option.charAt(0) === question.correctAnswer}}" class="correct-mark">âœ“</view>
              </view>
            </view>

            <!-- å¡«ç©ºé¢˜ç­”é¢˜åŒº -->
            <view wx:elif="{{question.type === 'fill_blank'}}" class="answer-area">
              <view class="answer-input-line"></view>
              <view wx:if="{{showAnswers}}" class="correct-answer">
                <text class="answer-label">å‚è€ƒç­”æ¡ˆï¼š</text>
                <text class="answer-text">{{question.correctAnswer}}</text>
              </view>
            </view>

            <!-- ç®€ç­”é¢˜ç­”é¢˜åŒº -->
            <view wx:elif="{{question.type === 'short_answer'}}" class="answer-area large">
              <view class="answer-input-area">
                <view class="answer-line" wx:for="{{[1,2,3,4,5]}}" wx:key="*this"></view>
              </view>
              <view wx:if="{{showAnswers}}" class="correct-answer">
                <text class="answer-label">å‚è€ƒç­”æ¡ˆï¼š</text>
                <text class="answer-text">{{question.correctAnswer}}</text>
              </view>
            </view>

            <!-- é¢˜ç›®è§£æ -->
            <view wx:if="{{showAnswers && question.explanation}}" class="question-explanation">
              <view class="explanation-header">
                <text class="explanation-icon">ğŸ’¡</text>
                <text class="explanation-title">è§£æ</text>
              </view>
              <text class="explanation-content">{{question.explanation}}</text>
            </view>

          </view>
        </view>
      </view>
    </view>

    <!-- æ‰“å°æ¨¡å¼æ“ä½œ -->
    <view wx:if="{{printMode}}" class="print-actions card">
      <van-button 
        type="default" 
        size="large" 
        bind:click="exitPrintMode"
        custom-class="print-btn"
      >
        è¿”å›
      </van-button>
      
      <van-button 
        type="primary" 
        size="large" 
        bind:click="printExam"
        custom-class="print-btn"
      >
        ä¿å­˜åˆ°ç›¸å†Œ
      </van-button>
    </view>

  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:else class="error-card card">
    <view class="error-content">
      <image class="error-icon" src="/images/empty-state-practice.svg" mode="widthFix"></image>
      <text class="error-title">è¯•å·ç”Ÿæˆå¤±è´¥</text>
      <text class="error-desc">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é‡æ–°å°è¯•</text>
      <van-button 
        type="primary" 
        size="large" 
        bind:click="generateSampleExam"
        custom-class="retry-btn"
      >
        é‡æ–°ç”Ÿæˆ
    </van-button>
    </view>
  </view>

  <!-- éšè—çš„canvasç”¨äºç”Ÿæˆå›¾ç‰‡ -->
  <canvas 
    wx:if="{{printMode}}" 
    id="examCanvas" 
    type="2d" 
    class="hidden-canvas"
  ></canvas>

</view>