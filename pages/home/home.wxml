<!-- pages/home/home.wxml -->
<view class="home-container">
  <!-- 1. 用户信息头部 -->
  <view class="header-section">
    <view class="user-info" bind:tap="onProfile">
      <image class="user-info__avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
      <view class="user-info__details">
        <view class="user-info__nickname">{{userInfo.nickName || '游客用户'}}</view>
        <view class="user-info__level">
          <image class="user-info__level-icon" src="/images/icons/level-badge.svg" />
          <text>Lv.{{userInfo.level || 1}} · {{greeting}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 2. 今日学习概览 -->
  <view class="overview-section">
    <view class="overview-header">
      <view class="overview-title">
        <view class="title-decorator"></view>
        今日学习概览
      </view>
      <van-button size="small" type="ghost" custom-class="overview-btn" bind:tap="onViewReport">查看报告</van-button>
    </view>

    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value text-blue">{{studyStats.todayMistakes}}</text>
        <text class="stat-label">今日录题</text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-orange">{{studyStats.reviewTasks}}</text>
        <text class="stat-label">待复习</text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-green">{{studyStats.masteredCount}}</text>
        <text class="stat-label">已掌握</text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-purple">{{studyStats.masteryRate}}%</text>
        <text class="stat-label">掌握率</text>
      </view>
    </view>
  </view>

  <!-- 3. 快捷操作 -->
  <view class="actions-section">
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/camera/camera" style="background-image: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/camera.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">拍照录题</view>
        <view class="action-item__desc">AI识别, 快速方便</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/mistakes/add" style="background-image: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/file-pen-line.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">手动录入</view>
        <view class="action-item__desc">手动输入, 巩固记忆</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/practice/practice" style="background-image: linear-gradient(135deg, #50E3C2 0%, #4A90E2 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/brain.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">AI练习</view>
        <view class="action-item__desc">智能出题, 举一反三</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/review/review" style="background-image: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/homework.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">错题复习</view>
        <view class="action-item__desc">温故知新, 拒绝遗忘</view>
      </view>
    </view>
  </view>

  <!-- 4. 智能推荐 -->
  <view wx:if="{{!loading && studyStats.totalMistakes > 0}}" class="recommendation-section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-decorator"></view>
        智能推荐
      </view>
      <view class="section-subtitle">基于学习情况的个性化建议</view>
    </view>

    <view wx:if="{{recommendations.loading}}" class="recommendation-loading">
      <van-skeleton title row="2" />
    </view>

    <view wx:else class="recommendation-content">
      <!-- 推荐卡片 -->
      <view wx:if="{{recommendations.items.length > 0}}" class="recommendation-cards">
        <view 
          wx:for="{{recommendations.items}}" 
          wx:key="type" 
          class="recommendation-card"
          style="border-left-color: {{item.color}}"
          bind:tap="onRecommendationTap"
          data-action="{{item.action}}"
          data-subject="{{item.subject}}"
        >
          <view class="card-header">
            <view class="card-icon" style="background-color: {{item.color}}">
              <image class="icon-img" src="/images/icons/{{item.icon}}.svg" />
            </view>
            <view class="card-title">{{item.title}}</view>
          </view>
          <view class="card-description">{{item.description}}</view>
          <view class="card-urgency">
            <view class="urgency-bar">
              <view class="urgency-fill" style="width: {{item.urgency * 100}}%; background-color: {{item.color}}"></view>
            </view>
          </view>
        </view>
      </view>

      <!-- 学习提示 -->
      <view wx:if="{{recommendations.tips.length > 0}}" class="learning-tips">
        <view class="tips-title">💡 学习提示</view>
        <view wx:for="{{recommendations.tips}}" wx:key="index" class="tip-item">
          <text class="tip-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 5. 复习提醒 -->
  <view wx:if="{{!loading && studyStats.totalMistakes > 0 && reviewReminder.primaryReminder.type !== 'none'}}" class="review-reminder-section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-decorator" style="background: {{reviewReminder.primaryReminder.color}}"></view>
        复习提醒
      </view>
      <view class="section-subtitle">基于遗忘曲线的智能提醒</view>
    </view>

    <view wx:if="{{reviewReminder.loading}}" class="reminder-loading">
      <van-skeleton title row="2" />
    </view>

    <view wx:else class="reminder-content">
      <!-- 主要提醒卡片 -->
      <view 
        class="reminder-card primary-reminder"
        style="border-left-color: {{reviewReminder.primaryReminder.color}}"
        bind:tap="onReminderTap"
        data-action="{{reviewReminder.primaryReminder.action}}"
        wx:if="{{reviewReminder.primaryReminder.type !== 'none'}}"
      >
        <view class="reminder-header">
          <view class="reminder-icon" style="background-color: {{reviewReminder.primaryReminder.color}}">
            <van-icon name="{{reviewReminder.primaryReminder.icon}}" size="20" color="#fff" />
          </view>
          <view class="reminder-info">
            <view class="reminder-title">{{reviewReminder.primaryReminder.title}}</view>
            <view class="reminder-message">{{reviewReminder.primaryReminder.message}}</view>
          </view>
          <view class="reminder-count" wx:if="{{reviewReminder.primaryReminder.count > 0}}">
            <text class="count-number">{{reviewReminder.primaryReminder.count}}</text>
          </view>
        </view>
      </view>

      <!-- 今日计划概览 -->
      <view wx:if="{{reviewReminder.todayPlan.total > 0}}" class="today-plan-summary">
        <view class="plan-header">
          <text class="plan-title">📅 今日复习计划</text>
          <text class="plan-time">{{reviewReminder.todayPlan.estimatedTime}}</text>
        </view>
        
        <view wx:if="{{reviewReminder.todayPlan.subjects.length > 0}}" class="plan-subjects">
          <view 
            wx:for="{{reviewReminder.todayPlan.subjects}}" 
            wx:key="subject" 
            class="subject-chip"
          >
            <text class="subject-name">{{item.subject}}</text>
            <text class="subject-count">{{item.count}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 6. 空状态/内容区 -->
  <view wx:if="{{loading}}" class="loading-placeholder card">
    <van-skeleton title row="3" />
  </view>
  <view wx:elif="{{!loading && studyStats.totalMistakes === 0}}" class="empty-state card">
    <image class="empty-state__image" src="/images/empty-state-home.svg" mode="widthFix" />
    <view class="empty-state__title">太棒了，还没有错题！</view>
    <view class="empty-state__desc">开始录入第一道错题，开启你的学霸之旅吧！</view>
    <van-button
      round
      type="primary"
      custom-class="empty-state__btn"
      bind:tap="handleActionTap" data-path="/pages/camera/camera"
    >
      <van-icon name="photograph" />
      去录题
    </van-button>
  </view>

</view> 