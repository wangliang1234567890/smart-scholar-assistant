<!-- pages/home/home.wxml -->
<view class="home-container">
  <!-- 1. ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="header-section">
    <view class="user-info" bind:tap="onProfile">
      <image class="user-info__avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill" />
      <view class="user-info__details">
        <view class="user-info__nickname">{{userInfo.nickName || 'æ¸¸å®¢ç”¨æˆ·'}}</view>
        <view class="user-info__level">
          <image class="user-info__level-icon" src="/images/icons/level-badge.svg" />
          <text>Lv.{{userInfo.level || 1}} Â· {{greeting}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 2. ä»Šæ—¥å­¦ä¹ æ¦‚è§ˆ -->
  <view class="overview-section">
    <view class="overview-header">
      <view class="overview-title">
        <view class="title-decorator"></view>
        ä»Šæ—¥å­¦ä¹ æ¦‚è§ˆ
      </view>
      <van-button size="small" type="ghost" custom-class="overview-btn" bind:tap="onViewReport">æŸ¥çœ‹æŠ¥å‘Š</van-button>
    </view>

    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value text-blue">{{studyStats.todayMistakes}}</text>
        <text class="stat-label">ä»Šæ—¥å½•é¢˜</text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-orange">{{studyStats.reviewTasks}}</text>
        <text class="stat-label">å¾…å¤ä¹ </text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-green">{{studyStats.masteredCount}}</text>
        <text class="stat-label">å·²æŒæ¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value text-purple">{{studyStats.masteryRate}}%</text>
        <text class="stat-label">æŒæ¡ç‡</text>
      </view>
    </view>
  </view>

  <!-- 3. å¿«æ·æ“ä½œ -->
  <view class="actions-section">
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/camera/camera" style="background-image: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/camera.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">æ‹ç…§å½•é¢˜</view>
        <view class="action-item__desc">AIè¯†åˆ«, å¿«é€Ÿæ–¹ä¾¿</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/mistakes/add" style="background-image: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/file-pen-line.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">æ‰‹åŠ¨å½•å…¥</view>
        <view class="action-item__desc">æ‰‹åŠ¨è¾“å…¥, å·©å›ºè®°å¿†</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/practice/practice" style="background-image: linear-gradient(135deg, #50E3C2 0%, #4A90E2 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/brain.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">AIç»ƒä¹ </view>
        <view class="action-item__desc">æ™ºèƒ½å‡ºé¢˜, ä¸¾ä¸€åä¸‰</view>
      </view>
    </view>
    <view class="action-item" bind:tap="handleActionTap" data-path="/pages/review/review" style="background-image: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
      <view class="action-icon-wrapper">
        <image class="action-icon" src="/images/icons/white/homework.svg" />
      </view>
      <view class="action-item__text">
        <view class="action-item__title">é”™é¢˜å¤ä¹ </view>
        <view class="action-item__desc">æ¸©æ•…çŸ¥æ–°, æ‹’ç»é—å¿˜</view>
      </view>
    </view>
  </view>

  <!-- 4. æ™ºèƒ½æ¨è -->
  <view wx:if="{{!loading && studyStats.totalMistakes > 0}}" class="recommendation-section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-decorator"></view>
        æ™ºèƒ½æ¨è
      </view>
      <view class="section-subtitle">åŸºäºå­¦ä¹ æƒ…å†µçš„ä¸ªæ€§åŒ–å»ºè®®</view>
    </view>

    <view wx:if="{{recommendations.loading}}" class="recommendation-loading">
      <van-skeleton title row="2" />
    </view>

    <view wx:else class="recommendation-content">
      <!-- æ¨èå¡ç‰‡ -->
      <view wx:if="{{recommendations.items.length > 0}}" class="recommendation-cards">
        <view 
          wx:for="{{recommendations.items}}" 
          wx:key="type" 
          class="recommendation-card"
          style="border-left-color: {{item.color}}"
          bind:tap="onRecommendationTap"
          data-action="{{item.action}}"
          data-subject="{{item.subject}}"
        >
          <view class="card-header">
            <view class="card-icon" style="background-color: {{item.color}}">
              <image class="icon-img" src="/images/icons/{{item.icon}}.svg" />
            </view>
            <view class="card-title">{{item.title}}</view>
          </view>
          <view class="card-description">{{item.description}}</view>
          <view class="card-urgency">
            <view class="urgency-bar">
              <view class="urgency-fill" style="width: {{item.urgency * 100}}%; background-color: {{item.color}}"></view>
            </view>
          </view>
        </view>
      </view>

      <!-- å­¦ä¹ æç¤º -->
      <view wx:if="{{recommendations.tips.length > 0}}" class="learning-tips">
        <view class="tips-title">ğŸ’¡ å­¦ä¹ æç¤º</view>
        <view wx:for="{{recommendations.tips}}" wx:key="index" class="tip-item">
          <text class="tip-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 5. å¤ä¹ æé†’ -->
  <view wx:if="{{!loading && studyStats.totalMistakes > 0 && reviewReminder.primaryReminder.type !== 'none'}}" class="review-reminder-section">
    <view class="section-header">
      <view class="section-title">
        <view class="title-decorator" style="background: {{reviewReminder.primaryReminder.color}}"></view>
        å¤ä¹ æé†’
      </view>
      <view class="section-subtitle">åŸºäºé—å¿˜æ›²çº¿çš„æ™ºèƒ½æé†’</view>
    </view>

    <view wx:if="{{reviewReminder.loading}}" class="reminder-loading">
      <van-skeleton title row="2" />
    </view>

    <view wx:else class="reminder-content">
      <!-- ä¸»è¦æé†’å¡ç‰‡ -->
      <view 
        class="reminder-card primary-reminder"
        style="border-left-color: {{reviewReminder.primaryReminder.color}}"
        bind:tap="onReminderTap"
        data-action="{{reviewReminder.primaryReminder.action}}"
        wx:if="{{reviewReminder.primaryReminder.type !== 'none'}}"
      >
        <view class="reminder-header">
          <view class="reminder-icon" style="background-color: {{reviewReminder.primaryReminder.color}}">
            <van-icon name="{{reviewReminder.primaryReminder.icon}}" size="20" color="#fff" />
          </view>
          <view class="reminder-info">
            <view class="reminder-title">{{reviewReminder.primaryReminder.title}}</view>
            <view class="reminder-message">{{reviewReminder.primaryReminder.message}}</view>
          </view>
          <view class="reminder-count" wx:if="{{reviewReminder.primaryReminder.count > 0}}">
            <text class="count-number">{{reviewReminder.primaryReminder.count}}</text>
          </view>
        </view>
      </view>

      <!-- ä»Šæ—¥è®¡åˆ’æ¦‚è§ˆ -->
      <view wx:if="{{reviewReminder.todayPlan.total > 0}}" class="today-plan-summary">
        <view class="plan-header">
          <text class="plan-title">ğŸ“… ä»Šæ—¥å¤ä¹ è®¡åˆ’</text>
          <text class="plan-time">{{reviewReminder.todayPlan.estimatedTime}}</text>
        </view>
        
        <view wx:if="{{reviewReminder.todayPlan.subjects.length > 0}}" class="plan-subjects">
          <view 
            wx:for="{{reviewReminder.todayPlan.subjects}}" 
            wx:key="subject" 
            class="subject-chip"
          >
            <text class="subject-name">{{item.subject}}</text>
            <text class="subject-count">{{item.count}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 6. ç©ºçŠ¶æ€/å†…å®¹åŒº -->
  <view wx:if="{{loading}}" class="loading-placeholder card">
    <van-skeleton title row="3" />
  </view>
  <view wx:elif="{{!loading && studyStats.totalMistakes === 0}}" class="empty-state card">
    <image class="empty-state__image" src="/images/empty-state-home.svg" mode="widthFix" />
    <view class="empty-state__title">å¤ªæ£’äº†ï¼Œè¿˜æ²¡æœ‰é”™é¢˜ï¼</view>
    <view class="empty-state__desc">å¼€å§‹å½•å…¥ç¬¬ä¸€é“é”™é¢˜ï¼Œå¼€å¯ä½ çš„å­¦éœ¸ä¹‹æ—…å§ï¼</view>
    <van-button
      round
      type="primary"
      custom-class="empty-state__btn"
      bind:tap="handleActionTap" data-path="/pages/camera/camera"
    >
      <van-icon name="photograph" />
      å»å½•é¢˜
    </van-button>
  </view>

</view> 