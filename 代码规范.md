# æ™ºèƒ½å­¦éœ¸å°åŠ©æ‰‹ - å¾®ä¿¡å°ç¨‹åºä»£ç è§„èŒƒ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°
æœ¬æ–‡æ¡£ä¸ºæ™ºèƒ½å­¦éœ¸å°åŠ©æ‰‹å¾®ä¿¡å°ç¨‹åºé¡¹ç›®åˆ¶å®šç»Ÿä¸€çš„ä»£ç è§„èŒƒï¼Œç¡®ä¿ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„è§„èŒƒ

```
smart-study-assistant/
â”œâ”€â”€ pages/                    # é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ home/                # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ home.js
â”‚   â”‚   â”œâ”€â”€ home.json
â”‚   â”‚   â”œâ”€â”€ home.wxml
â”‚   â”‚   â””â”€â”€ home.wxss
â”‚   â”œâ”€â”€ mistakes/            # é”™é¢˜æœ¬
â”‚   â”œâ”€â”€ camera/              # æ‹ç…§å½•é¢˜
â”‚   â””â”€â”€ ...
â”œâ”€â”€ components/              # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”œâ”€â”€ study-card/         # å­¦ä¹ å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ page-header/        # é¡µé¢å¤´éƒ¨ç»„ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ utils/                   # å·¥å…·ç±»
â”‚   â”œâ”€â”€ database.js         # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ auth.js             # ç”¨æˆ·è®¤è¯
â”‚   â”œâ”€â”€ storage.js          # æœ¬åœ°å­˜å‚¨
â”‚   â”œâ”€â”€ api.js              # APIæ¥å£
â”‚   â””â”€â”€ constants.js        # å¸¸é‡å®šä¹‰
â”œâ”€â”€ store/                   # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ index.js            # ä¸»store
â”‚   â”œâ”€â”€ user.js             # ç”¨æˆ·çŠ¶æ€
â”‚   â””â”€â”€ study.js            # å­¦ä¹ æ•°æ®çŠ¶æ€
â”œâ”€â”€ styles/                  # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ variables.wxss      # å˜é‡å®šä¹‰
â”‚   â”œâ”€â”€ mixins.wxss         # æ ·å¼æ··å…¥
â”‚   â””â”€â”€ common.wxss         # é€šç”¨æ ·å¼
â”œâ”€â”€ images/                  # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ icons/              # å›¾æ ‡
â”‚   â”œâ”€â”€ illustrations/      # æ’å›¾
â”‚   â””â”€â”€ backgrounds/        # èƒŒæ™¯å›¾
â”œâ”€â”€ cloud/                   # äº‘å¼€å‘
â”‚   â”œâ”€â”€ functions/          # äº‘å‡½æ•°
â”‚   â””â”€â”€ database/           # æ•°æ®åº“è§„åˆ™
â”œâ”€â”€ app.js                   # åº”ç”¨å…¥å£
â”œâ”€â”€ app.json                 # åº”ç”¨é…ç½®
â”œâ”€â”€ app.wxss                 # å…¨å±€æ ·å¼
â”œâ”€â”€ project.config.json      # é¡¹ç›®é…ç½®
â””â”€â”€ package.json             # ä¾èµ–ç®¡ç†
```

---

## ğŸ¯ å‘½åè§„èŒƒ

### 1. æ–‡ä»¶å’Œç›®å½•å‘½å
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨kebab-case
pages/mistake-detail/mistake-detail.js
components/study-card/study-card.js
utils/database-manager.js

// âŒ é”™è¯¯ï¼šé©¼å³°å‘½å
pages/mistakeDetail/mistakeDetail.js
components/studyCard/studyCard.js
```

### 2. å˜é‡å’Œå‡½æ•°å‘½å
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨camelCase
const userName = 'student';
const mistakesList = [];
function loadMistakeData() {}
async function submitAnswer() {}

// âŒ é”™è¯¯ï¼šå…¶ä»–å‘½åæ–¹å¼
const user_name = 'student';
const MistakesList = [];
function LoadMistakeData() {}
```

### 3. å¸¸é‡å‘½å
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨SCREAMING_SNAKE_CASE
const API_BASE_URL = 'https://api.example.com';
const MAX_RETRY_COUNT = 3;
const SUBJECTS = ['æ•°å­¦', 'è¯­æ–‡', 'è‹±è¯­'];
const DIFFICULTY_LEVELS = {
  EASY: 1,
  MEDIUM: 3,
  HARD: 5
};
```

### 4. ç»„ä»¶å‘½å
```javascript
// âœ… æ­£ç¡®ï¼šç»„ä»¶åä½¿ç”¨PascalCase
Component({
  name: 'StudyCard',
  properties: {
    mistakeData: Object,
    showActions: Boolean
  }
});

// åœ¨WXMLä¸­ä½¿ç”¨kebab-case
<study-card mistake-data="{{item}}" show-actions="{{true}}"></study-card>
```

---

## ğŸ“„ æ–‡ä»¶è§„èŒƒ

### 1. é¡µé¢æ–‡ä»¶ç»“æ„ï¼ˆPageï¼‰
```javascript
// pages/mistakes/mistakes.js
import DatabaseManager from '../../utils/database';
import { store } from '../../store/index';

Page({
  // 1. é¡µé¢æ•°æ®
  data: {
    currentSubject: 'å…¨éƒ¨',
    mistakesList: [],
    loading: false,
    page: 1,
    hasMore: true
  },

  // 2. ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆæŒ‰è°ƒç”¨é¡ºåºï¼‰
  onLoad(options) {
    console.log('é¡µé¢åŠ è½½', options);
    this.initPage();
  },

  onShow() {
    this.refreshData();
  },

  onReady() {
    // é¡µé¢æ¸²æŸ“å®Œæˆ
  },

  onHide() {
    // é¡µé¢éšè—
  },

  onUnload() {
    // é¡µé¢å¸è½½ï¼Œæ¸…ç†èµ„æº
    this.cleanup();
  },

  // 3. äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆæŒ‰å­—æ¯é¡ºåºï¼‰
  onMistakeDetail(e) {
    const { id } = e.currentTarget.dataset;
    wx.navigateTo({
      url: `/pages/mistake-detail/mistake-detail?id=${id}`
    });
  },

  onPullDownRefresh() {
    this.refreshData();
  },

  onReachBottom() {
    this.loadMore();
  },

  onSubjectChange(e) {
    const subject = this.data.subjects[e.detail.value];
    this.setData({ currentSubject: subject });
    this.loadMistakes();
  },

  // 4. è‡ªå®šä¹‰æ–¹æ³•ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç»„ï¼‰
  // åˆå§‹åŒ–ç›¸å…³
  initPage() {
    this.loadMistakes();
  },

  // æ•°æ®åŠ è½½ç›¸å…³
  async loadMistakes() {
    try {
      this.setData({ loading: true });
      const mistakes = await DatabaseManager.getMistakes();
      this.setData({ 
        mistakesList: mistakes,
        loading: false 
      });
    } catch (error) {
      console.error('åŠ è½½é”™é¢˜å¤±è´¥:', error);
      this.handleError(error);
    }
  },

  async loadMore() {
    if (this.data.hasMore && !this.data.loading) {
      // åŠ è½½æ›´å¤šé€»è¾‘
    }
  },

  // å·¥å…·æ–¹æ³•
  refreshData() {
    this.setData({ page: 1 });
    this.loadMistakes();
  },

  handleError(error) {
    wx.showToast({
      title: 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•',
      icon: 'none'
    });
  },

  cleanup() {
    // æ¸…ç†å®šæ—¶å™¨ã€ç›‘å¬å™¨ç­‰
  }
});
```

### 2. ç»„ä»¶æ–‡ä»¶ç»“æ„ï¼ˆComponentï¼‰
```javascript
// components/study-card/study-card.js
Component({
  // 1. ç»„ä»¶é…ç½®
  options: {
    styleIsolation: 'isolated',
    multipleSlots: true
  },

  // 2. ç»„ä»¶å±æ€§
  properties: {
    mistakeData: {
      type: Object,
      value: {},
      observer: 'onMistakeDataChange'
    },
    showActions: {
      type: Boolean,
      value: true
    }
  },

  // 3. ç»„ä»¶æ•°æ®
  data: {
    isExpanded: false,
    actionItems: []
  },

  // 4. ç”Ÿå‘½å‘¨æœŸ
  attached() {
    this.initComponent();
  },

  detached() {
    this.cleanup();
  },

  // 5. ç»„ä»¶æ–¹æ³•
  methods: {
    // äº‹ä»¶å¤„ç†
    onCardTap() {
      this.setData({ isExpanded: !this.data.isExpanded });
      this.triggerEvent('cardtap', { 
        mistake: this.data.mistakeData 
      });
    },

    onActionTap(e) {
      const { action } = e.currentTarget.dataset;
      this.triggerEvent('actiontap', { 
        action, 
        mistake: this.data.mistakeData 
      });
    },

    // å±æ€§è§‚å¯Ÿå™¨
    onMistakeDataChange(newVal) {
      if (newVal && newVal.id) {
        this.processData(newVal);
      }
    },

    // ç§æœ‰æ–¹æ³•
    initComponent() {
      this.setData({
        actionItems: this.generateActions()
      });
    },

    processData(data) {
      // å¤„ç†ä¼ å…¥çš„æ•°æ®
    },

    generateActions() {
      return ['edit', 'delete', 'practice'];
    },

    cleanup() {
      // æ¸…ç†å·¥ä½œ
    }
  }
});
```

---

## ğŸ¨ æ ·å¼è§„èŒƒï¼ˆWXSSï¼‰

### 1. æ ·å¼æ–‡ä»¶ç»“æ„
```css
/* pages/mistakes/mistakes.wxss */

/* 1. é¡µé¢å˜é‡ */
page {
  --primary-color: #4F46E5;
  --success-color: #10B981;
  --warning-color: #F59E0B;
  --danger-color: #EF4444;
  --text-primary: #1F2937;
  --text-secondary: #6B7280;
  --bg-primary: #FFFFFF;
  --bg-secondary: #F8FAFC;
}

/* 2. é¡µé¢æ•´ä½“å¸ƒå±€ */
.page-container {
  min-height: 100vh;
  background-color: var(--bg-secondary);
  padding: 0 24rpx;
}

/* 3. åŠŸèƒ½åŒºå—æ ·å¼ */
.header-section {
  padding: 32rpx 0;
  background: var(--bg-primary);
}

.filter-section {
  margin-bottom: 24rpx;
}

.list-section {
  flex: 1;
}

/* 4. ç»„ä»¶æ ·å¼ */
.mistake-item {
  background: var(--bg-primary);
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 16rpx;
  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);
}

.mistake-item:last-child {
  margin-bottom: 0;
}

/* 5. çŠ¶æ€æ ·å¼ */
.loading {
  opacity: 0.6;
  pointer-events: none;
}

.empty-state {
  text-align: center;
  padding: 120rpx 0;
  color: var(--text-secondary);
}

/* 6. å“åº”å¼æ ·å¼ */
@media (max-width: 375px) {
  .page-container {
    padding: 0 16rpx;
  }
}
```

### 2. é€šç”¨æ ·å¼ç±»
```css
/* styles/common.wxss */

/* å¸ƒå±€ç±» */
.flex {
  display: flex;
}

.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-column {
  display: flex;
  flex-direction: column;
}

/* æ–‡å­—ç±» */
.text-primary {
  color: var(--text-primary);
}

.text-secondary {
  color: var(--text-secondary);
}

.text-center {
  text-align: center;
}

.text-bold {
  font-weight: bold;
}

/* é—´è·ç±» */
.m-0 { margin: 0; }
.m-1 { margin: 8rpx; }
.m-2 { margin: 16rpx; }
.m-3 { margin: 24rpx; }

.p-0 { padding: 0; }
.p-1 { padding: 8rpx; }
.p-2 { padding: 16rpx; }
.p-3 { padding: 24rpx; }

/* å¡ç‰‡ç±» */
.card {
  background: var(--bg-primary);
  border-radius: 16rpx;
  padding: 24rpx;
  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);
}

.card-header {
  font-size: 32rpx;
  font-weight: bold;
  margin-bottom: 16rpx;
}

.card-content {
  color: var(--text-secondary);
  line-height: 1.6;
}
```

---

## ğŸ“ WXMLæ¨¡æ¿è§„èŒƒ

### 1. æ¨¡æ¿ç»“æ„
```xml
<!-- pages/mistakes/mistakes.wxml -->
<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <page-header title="é”™é¢˜æœ¬" show-back="{{false}}">
      <view slot="right" class="header-actions">
        <van-icon name="plus" size="20px" bind:tap="onAddMistake" />
      </view>
    </page-header>
  </view>

  <!-- ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <van-dropdown-menu>
      <van-dropdown-item 
        value="{{currentSubject}}" 
        options="{{subjectOptions}}"
        bind:change="onSubjectChange" 
      />
    </van-dropdown-menu>
  </view>

  <!-- åˆ—è¡¨åŒºåŸŸ -->
  <view class="list-section">
    <block wx:if="{{mistakesList.length > 0}}">
      <mistake-item
        wx:for="{{mistakesList}}"
        wx:key="id"
        mistake-data="{{item}}"
        bind:cardtap="onMistakeDetail"
        bind:actiontap="onMistakeAction"
      />
    </block>
    
    <view wx:else class="empty-state">
      <van-empty description="æš‚æ— é”™é¢˜è®°å½•" />
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <van-loading wx:if="{{loading}}" />
</view>
```

### 2. æ¨¡æ¿ç¼–å†™è§„åˆ™
```xml
<!-- âœ… æ­£ç¡®ï¼šå±æ€§æ¢è¡Œå¯¹é½ -->
<van-button
  type="primary"
  size="large"
  loading="{{submitting}}"
  disabled="{{!canSubmit}}"
  bind:tap="onSubmit"
>
  æäº¤ç­”æ¡ˆ
</van-button>

<!-- âŒ é”™è¯¯ï¼šå±æ€§ä¸å¯¹é½ -->
<van-button type="primary" size="large" loading="{{submitting}}" disabled="{{!canSubmit}}" bind:tap="onSubmit">æäº¤ç­”æ¡ˆ</van-button>

<!-- âœ… æ­£ç¡®ï¼šæ¡ä»¶æ¸²æŸ“ -->
<view wx:if="{{userInfo.isVip}}" class="vip-badge">VIP</view>
<view wx:elif="{{userInfo.level > 5}}" class="high-level">é«˜çº§ç”¨æˆ·</view>
<view wx:else class="normal-user">æ™®é€šç”¨æˆ·</view>

<!-- âœ… æ­£ç¡®ï¼šåˆ—è¡¨æ¸²æŸ“ -->
<view 
  wx:for="{{questionList}}"
  wx:key="id"
  wx:for-item="question"
  wx:for-index="idx"
  class="question-item"
>
  {{idx + 1}}. {{question.title}}
</view>
```

---

## ğŸ”§ å·¥å…·ç±»è§„èŒƒ

### 1. æ•°æ®åº“æ“ä½œç±»
```javascript
// utils/database.js
class DatabaseManager {
  constructor() {
    this.db = wx.cloud.database();
    this.collections = {
      USERS: 'users',
      MISTAKES: 'mistakes',
      PRACTICE_RECORDS: 'practice_records'
    };
  }

  /**
   * åˆ›å»ºç”¨æˆ·
   * @param {Object} userInfo - ç”¨æˆ·ä¿¡æ¯
   * @returns {Promise<Object>} åˆ›å»ºç»“æœ
   */
  async createUser(userInfo) {
    try {
      const result = await this.db.collection(this.collections.USERS).add({
        data: {
          ...userInfo,
          createTime: new Date(),
          updateTime: new Date()
        }
      });
      
      console.log('ç”¨æˆ·åˆ›å»ºæˆåŠŸ:', result._id);
      return result;
    } catch (error) {
      console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥:', error);
      throw this.handleError(error, 'åˆ›å»ºç”¨æˆ·å¤±è´¥');
    }
  }

  /**
   * è·å–ç”¨æˆ·ä¿¡æ¯
   * @param {string} openid - ç”¨æˆ·openid
   * @returns {Promise<Object|null>} ç”¨æˆ·ä¿¡æ¯
   */
  async getUserInfo(openid) {
    if (!openid) {
      throw new Error('openidä¸èƒ½ä¸ºç©º');
    }

    try {
      const result = await this.db.collection(this.collections.USERS)
        .where({ openid })
        .get();
      
      return result.data[0] || null;
    } catch (error) {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      throw this.handleError(error, 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
    }
  }

  /**
   * é”™è¯¯å¤„ç†
   * @param {Error} error - åŸå§‹é”™è¯¯
   * @param {string} message - ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   * @returns {Error} å¤„ç†åçš„é”™è¯¯
   */
  handleError(error, message) {
    const handledError = new Error(message);
    handledError.originalError = error;
    return handledError;
  }
}

export default new DatabaseManager();
```

### 2. APIæ¥å£ç±»
```javascript
// utils/api.js
class ApiManager {
  constructor() {
    this.baseURL = 'https://api.example.com';
    this.timeout = 10000;
  }

  /**
   * é€šç”¨è¯·æ±‚æ–¹æ³•
   * @param {Object} options - è¯·æ±‚é…ç½®
   * @returns {Promise<Object>} è¯·æ±‚ç»“æœ
   */
  async request(options) {
    const { url, method = 'GET', data, headers = {} } = options;
    
    const requestConfig = {
      url: `${this.baseURL}${url}`,
      method,
      timeout: this.timeout,
      header: {
        'Content-Type': 'application/json',
        ...headers
      }
    };

    if (data) {
      requestConfig.data = data;
    }

    try {
      const response = await this.promisify(wx.request)(requestConfig);
      return this.handleResponse(response);
    } catch (error) {
      console.error('APIè¯·æ±‚å¤±è´¥:', error);
      throw this.handleError(error);
    }
  }

  /**
   * GETè¯·æ±‚
   * @param {string} url - è¯·æ±‚URL
   * @param {Object} params - æŸ¥è¯¢å‚æ•°
   * @returns {Promise<Object>} è¯·æ±‚ç»“æœ
   */
  async get(url, params = {}) {
    const queryString = this.buildQueryString(params);
    const requestUrl = queryString ? `${url}?${queryString}` : url;
    
    return this.request({
      url: requestUrl,
      method: 'GET'
    });
  }

  /**
   * POSTè¯·æ±‚
   * @param {string} url - è¯·æ±‚URL
   * @param {Object} data - è¯·æ±‚æ•°æ®
   * @returns {Promise<Object>} è¯·æ±‚ç»“æœ
   */
  async post(url, data = {}) {
    return this.request({
      url,
      method: 'POST',
      data
    });
  }

  // å·¥å…·æ–¹æ³•
  buildQueryString(params) {
    return Object.keys(params)
      .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
      .join('&');
  }

  promisify(fn) {
    return (options = {}) => {
      return new Promise((resolve, reject) => {
        fn({
          ...options,
          success: resolve,
          fail: reject
        });
      });
    };
  }

  handleResponse(response) {
    const { data, statusCode } = response;
    
    if (statusCode >= 200 && statusCode < 300) {
      if (data.code === 200) {
        return data.data;
      } else {
        throw new Error(data.message || 'è¯·æ±‚å¤±è´¥');
      }
    } else {
      throw new Error(`HTTPé”™è¯¯: ${statusCode}`);
    }
  }

  handleError(error) {
    if (error.errMsg) {
      // å¾®ä¿¡APIé”™è¯¯
      return new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.errMsg}`);
    }
    return error;
  }
}

export default new ApiManager();
```

---

## ğŸ­ çŠ¶æ€ç®¡ç†è§„èŒƒ

### 1. Storeç»“æ„
```javascript
// store/index.js
import { observable, action } from 'mobx-miniprogram';

export const store = observable({
  // ç”¨æˆ·ç›¸å…³çŠ¶æ€
  user: {
    info: null,
    isLogin: false,
    settings: {}
  },

  // å­¦ä¹ æ•°æ®çŠ¶æ€
  study: {
    todayMistakes: 0,
    totalMistakes: 0,
    reviewTasks: 0,
    currentSubject: 'å…¨éƒ¨'
  },

  // UIçŠ¶æ€
  ui: {
    loading: false,
    networkStatus: 'connected'
  },

  // Actions
  setUserInfo: action(function(userInfo) {
    this.user.info = userInfo;
    this.user.isLogin = true;
  }),

  updateStudyStats: action(function(stats) {
    Object.assign(this.study, stats);
  }),

  setLoading: action(function(loading) {
    this.ui.loading = loading;
  }),

  logout: action(function() {
    this.user.info = null;
    this.user.isLogin = false;
    this.study = {
      todayMistakes: 0,
      totalMistakes: 0,
      reviewTasks: 0,
      currentSubject: 'å…¨éƒ¨'
    };
  })
});

// è®¡ç®—å±æ€§
export const computed = {
  get studyProgress() {
    const { todayMistakes, reviewTasks } = store.study;
    return Math.min(100, (todayMistakes + reviewTasks) * 10);
  },

  get userLevel() {
    const exp = store.user.info?.exp || 0;
    return Math.floor(exp / 1000) + 1;
  }
};
```

---

## ğŸš¦ é”™è¯¯å¤„ç†è§„èŒƒ

### 1. é”™è¯¯åˆ†ç±»å’Œå¤„ç†
```javascript
// utils/error-handler.js
class ErrorHandler {
  // é”™è¯¯ç±»å‹
  static ERROR_TYPES = {
    NETWORK: 'network',
    AUTH: 'auth',
    VALIDATION: 'validation',
    BUSINESS: 'business',
    UNKNOWN: 'unknown'
  };

  /**
   * ç»Ÿä¸€é”™è¯¯å¤„ç†
   * @param {Error} error - é”™è¯¯å¯¹è±¡
   * @param {string} context - é”™è¯¯ä¸Šä¸‹æ–‡
   */
  static handle(error, context = '') {
    const errorType = this.getErrorType(error);
    const errorInfo = this.formatError(error, errorType, context);
    
    // è®°å½•é”™è¯¯æ—¥å¿—
    this.logError(errorInfo);
    
    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    this.showUserError(errorInfo);
    
    // ä¸ŠæŠ¥é”™è¯¯ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    if (this.isProduction()) {
      this.reportError(errorInfo);
    }
  }

  /**
   * åˆ¤æ–­é”™è¯¯ç±»å‹
   * @param {Error} error - é”™è¯¯å¯¹è±¡
   * @returns {string} é”™è¯¯ç±»å‹
   */
  static getErrorType(error) {
    if (error.errMsg) {
      if (error.errMsg.includes('network')) {
        return this.ERROR_TYPES.NETWORK;
      }
      if (error.errMsg.includes('auth')) {
        return this.ERROR_TYPES.AUTH;
      }
    }
    
    if (error.name === 'ValidationError') {
      return this.ERROR_TYPES.VALIDATION;
    }
    
    return this.ERROR_TYPES.UNKNOWN;
  }

  /**
   * æ ¼å¼åŒ–é”™è¯¯ä¿¡æ¯
   * @param {Error} error - é”™è¯¯å¯¹è±¡
   * @param {string} type - é”™è¯¯ç±»å‹
   * @param {string} context - é”™è¯¯ä¸Šä¸‹æ–‡
   * @returns {Object} æ ¼å¼åŒ–åçš„é”™è¯¯ä¿¡æ¯
   */
  static formatError(error, type, context) {
    return {
      type,
      context,
      message: error.message,
      stack: error.stack,
      timestamp: new Date().toISOString(),
      userAgent: wx.getSystemInfoSync()
    };
  }

  /**
   * æ˜¾ç¤ºç”¨æˆ·é”™è¯¯ä¿¡æ¯
   * @param {Object} errorInfo - é”™è¯¯ä¿¡æ¯
   */
  static showUserError(errorInfo) {
    const userMessages = {
      [this.ERROR_TYPES.NETWORK]: 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
      [this.ERROR_TYPES.AUTH]: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
      [this.ERROR_TYPES.VALIDATION]: 'è¾“å…¥ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•',
      [this.ERROR_TYPES.BUSINESS]: 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
      [this.ERROR_TYPES.UNKNOWN]: 'ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»å®¢æœ'
    };

    wx.showToast({
      title: userMessages[errorInfo.type] || userMessages[this.ERROR_TYPES.UNKNOWN],
      icon: 'none',
      duration: 3000
    });
  }

  static logError(errorInfo) {
    console.error(`[${errorInfo.type}] ${errorInfo.context}:`, errorInfo);
  }

  static isProduction() {
    return wx.getAccountInfoSync().miniProgram.envVersion === 'release';
  }

  static reportError(errorInfo) {
    // ä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§å¹³å°
    wx.cloud.callFunction({
      name: 'reportError',
      data: errorInfo
    }).catch(err => {
      console.error('é”™è¯¯ä¸ŠæŠ¥å¤±è´¥:', err);
    });
  }
}

export default ErrorHandler;
```

---

## ğŸ“± æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. æ•°æ®åŠ è½½ä¼˜åŒ–
```javascript
// åˆ†é¡µåŠ è½½ç¤ºä¾‹
class DataLoader {
  constructor(pageSize = 20) {
    this.pageSize = pageSize;
    this.currentPage = 1;
    this.hasMore = true;
    this.loading = false;
  }

  async loadData(isRefresh = false) {
    if (this.loading) return;

    try {
      this.loading = true;
      
      if (isRefresh) {
        this.currentPage = 1;
      }

      const result = await DatabaseManager.getMistakes({
        page: this.currentPage,
        pageSize: this.pageSize
      });

      const newData = result.data || [];
      this.hasMore = newData.length === this.pageSize;

      if (isRefresh) {
        this.data = newData;
      } else {
        this.data = [...(this.data || []), ...newData];
      }

      this.currentPage++;
      return this.data;
    } catch (error) {
      ErrorHandler.handle(error, 'DataLoader.loadData');
      throw error;
    } finally {
      this.loading = false;
    }
  }
}
```

### 2. å›¾ç‰‡ä¼˜åŒ–
```javascript
// å›¾ç‰‡å¤„ç†å·¥å…·
class ImageProcessor {
  // å‹ç¼©å›¾ç‰‡
  static async compressImage(imagePath, quality = 0.8) {
    return new Promise((resolve, reject) => {
      wx.compressImage({
        src: imagePath,
        quality: Math.floor(quality * 100),
        success: resolve,
        fail: reject
      });
    });
  }

  // ä¸Šä¼ å›¾ç‰‡
  static async uploadImage(localPath, cloudPath) {
    try {
      // å…ˆå‹ç¼©å›¾ç‰‡
      const compressed = await this.compressImage(localPath);
      
      // ä¸Šä¼ åˆ°äº‘å­˜å‚¨
      const result = await wx.cloud.uploadFile({
        cloudPath: `images/${Date.now()}-${cloudPath}`,
        filePath: compressed.tempFilePath
      });

      return result.fileID;
    } catch (error) {
      ErrorHandler.handle(error, 'ImageProcessor.uploadImage');
      throw error;
    }
  }
}
```

---

## ğŸ”’ å®‰å…¨è§„èŒƒ

### 1. æ•°æ®éªŒè¯
```javascript
// utils/validator.js
class Validator {
  // éªŒè¯ç”¨æˆ·è¾“å…¥
  static validateMistakeInput(data) {
    const errors = [];

    if (!data.subject || !data.subject.trim()) {
      errors.push('å­¦ç§‘ä¸èƒ½ä¸ºç©º');
    }

    if (!data.question || data.question.trim().length < 5) {
      errors.push('é¢˜ç›®å†…å®¹è‡³å°‘5ä¸ªå­—ç¬¦');
    }

    if (!data.answer || !data.answer.trim()) {
      errors.push('ç­”æ¡ˆä¸èƒ½ä¸ºç©º');
    }

    if (data.difficulty && (data.difficulty < 1 || data.difficulty > 5)) {
      errors.push('éš¾åº¦ç­‰çº§å¿…é¡»åœ¨1-5ä¹‹é—´');
    }

    return {
      isValid: errors.length === 0,
      errors
    };
  }

  // éªŒè¯æ–‡ä»¶
  static validateImageFile(file) {
    const maxSize = 5 * 1024 * 1024; // 5MB
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];

    if (file.size > maxSize) {
      throw new Error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
    }

    if (!allowedTypes.includes(file.type)) {
      throw new Error('åªæ”¯æŒjpgã€pngã€gifæ ¼å¼å›¾ç‰‡');
    }

    return true;
  }
}

export default Validator;
```

---

## ğŸ“‹ ä»£ç å®¡æŸ¥æ¸…å•

### æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç ç¬¦åˆå‘½åè§„èŒƒ
- [ ] æ·»åŠ äº†é€‚å½“çš„æ³¨é‡Š
- [ ] å¤„ç†äº†å¼‚å¸¸æƒ…å†µ
- [ ] æ²¡æœ‰console.logè°ƒè¯•ä¿¡æ¯
- [ ] æ€§èƒ½æ•æ„Ÿä»£ç å·²ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒè‰¯å¥½
- [ ] å…¼å®¹æ€§æµ‹è¯•é€šè¿‡

### Code Reviewè¦ç‚¹
- [ ] é€»è¾‘æ­£ç¡®æ€§
- [ ] é”™è¯¯å¤„ç†å®Œæ•´
- [ ] ä»£ç å¯è¯»æ€§
- [ ] å®‰å…¨æ€§æ£€æŸ¥
- [ ] æ€§èƒ½å½±å“è¯„ä¼°
- [ ] æµ‹è¯•è¦†ç›–æƒ…å†µ

---

*æœ¬è§„èŒƒå°†æ ¹æ®é¡¹ç›®å‘å±•æŒç»­æ›´æ–°å®Œå–„ï¼Œè¯·å›¢é˜Ÿæˆå‘˜ä¸¥æ ¼éµå®ˆã€‚* 